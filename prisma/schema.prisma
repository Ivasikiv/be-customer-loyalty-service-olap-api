generator client {
  provider = "prisma-client-js"
}

generator prisma_nestjs_graphql {
  provider = "prisma-nestjs-graphql"
  output   = "../src/@generated/prisma-nestjs-graphql"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model DimAssortmentSegment {
  AssortmentSegmentID   Int                   @id @unique
  AssortmentSegmentType String                @db.VarChar(50)
  Points                Int
  
  FactTransactionItem   FactTransactionItem[]
}

model DimLoyaltyCard {
  LoyaltyCardID        Int                    @id @unique
  CardType             String                 @db.VarChar(50)
  DiscountPercentage   Decimal                @db.Decimal(5, 2)
  CardNumber           String                 @db.VarChar(20)
  CardBalance          Int                    
  
  FactTransactionCheck FactTransactionCheck[]
}

model DimDate {
  DateID               Int                    @id @unique @default(autoincrement())
  FullDate             DateTime               @db.Timestamp(6)
  DayOfWeek            String                 @db.VarChar(50)
  WeekNumber           String                 @db.VarChar(50)
  CalendarMonth        String                 @db.VarChar(50)
  CalendarQuarter      String                 @db.VarChar(50)
  CalendarYear         String                 @db.VarChar(50)
  
  FactTransactionCheck FactTransactionCheck[]
  FactTransactionItem  FactTransactionItem[]
}

model DimSeller {
  SellerID             Int                    @id @unique
  FirstName            String                 @db.VarChar(50)
  LastName             String                 @db.VarChar(50)
  
  FactTransactionCheck FactTransactionCheck[]
  FactTransactionItem  FactTransactionItem[]
}

model DimLocation {
  LocationID           Int                    @id @unique
  PartnerName          Int
  LocationName         String                 @db.VarChar(100)
  Address              String                 @db.VarChar(255)
  City                 String                 @db.VarChar(100)
  State                String?                @db.VarChar(100)
  ZipCode              String?                @db.VarChar(20)
  Country              String                 @db.VarChar(100)
  
  FactTransactionCheck FactTransactionCheck[]
  FactTransactionItem  FactTransactionItem[]
}

model DimLoyaltyUser {
  LoyaltyUserID        Int                    @id @unique
  FirstName            String                 @db.VarChar(50)
  LastName             String                 @db.VarChar(50)
  Age                  Int
  
  FactTransactionCheck FactTransactionCheck[]
  FactTransactionItem  FactTransactionItem[]
}

model DimPromoCampaign {
  PromoCampaignID      Int                    @id @unique
  PromoCampaignName    String                 @db.VarChar(100)
  Description          String
  StartDate            DateTime               @db.Timestamp(6)
  EndDate              DateTime?              @db.Timestamp(6)
  
  FactTransactionItem  FactTransactionItem[]
}     

model DimTime {
  TimeID               Int                    @id @unique @default(autoincrement())
  FullTime             DateTime               @db.Timestamp(6)
  HourOfDay            String                 @db.VarChar(50)
  MinuteOfHour         String                 @db.VarChar(50)
  AMorPM               String?                @db.VarChar(50)
  
  FactTransactionCheck FactTransactionCheck[]
  FactTransactionItem  FactTransactionItem[]
}

model FactTransactionCheck {
  TransactionCheckID    Int               @id @unique @default(autoincrement())
  DateID                Int
  TimeID                Int
  LoyaltyCardID         Int
  SellerID              Int
  LoyaltyUserID         Int
  LocationID            Int
  PaymentMethod         String            @db.VarChar(50)
  TimeFromLastCardUsage Int?
  PointsAccumulated     Int?
  PointsWithdraw        Int?
  TotalPrice            Decimal           @db.Decimal(10, 2)
  
  CreateDate            DateTime          @default(now()) @db.Timestamp(6)
  UpdateDate            DateTime?         @db.Timestamp(6)
  
  DimLoyaltyCard        DimLoyaltyCard    @relation(fields: [LoyaltyCardID], references: [LoyaltyCardID], onDelete: NoAction, onUpdate: NoAction)
  DimDate               DimDate           @relation(fields: [DateID], references: [DateID], onDelete: NoAction, onUpdate: NoAction)
  DimSeller             DimSeller         @relation(fields: [SellerID], references: [SellerID], onDelete: NoAction, onUpdate: NoAction)
  DimLocation           DimLocation       @relation(fields: [LocationID], references: [LocationID], onDelete: NoAction, onUpdate: NoAction)
  DimLoyaltyUser        DimLoyaltyUser    @relation(fields: [LoyaltyUserID], references: [LoyaltyUserID], onDelete: NoAction, onUpdate: NoAction)
  DimTime               DimTime           @relation(fields: [TimeID], references: [TimeID], onDelete: NoAction, onUpdate: NoAction)
}

model FactTransactionItem {
  TransactionItemID    Int                  @id @unique @default(autoincrement())
  DateID               Int
  TimeID               Int
  AssortmentSegmentID  Int
  PromoCampaignID      Int?
  SellerID             Int
  LoyaltyUserID        Int
  LocationID           Int
  ItemName             String?              @db.VarChar(50)
  QuantitySold         Int?
  Price                Int?
  TotalPoints          Int?
  
  CreateDate           DateTime             @default(now()) @db.Timestamp(6)
  UpdateDate           DateTime?            @db.Timestamp(6)
  
  DimAssortmentSegment DimAssortmentSegment @relation(fields: [AssortmentSegmentID], references: [AssortmentSegmentID], onDelete: NoAction, onUpdate: NoAction)
  DimDate              DimDate              @relation(fields: [DateID], references: [DateID], onDelete: NoAction, onUpdate: NoAction)
  DimSeller            DimSeller            @relation(fields: [SellerID], references: [SellerID], onDelete: NoAction, onUpdate: NoAction)
  DimLocation          DimLocation          @relation(fields: [LocationID], references: [LocationID], onDelete: NoAction, onUpdate: NoAction)
  DimLoyaltyUser       DimLoyaltyUser       @relation(fields: [LoyaltyUserID], references: [LoyaltyUserID], onDelete: NoAction, onUpdate: NoAction)
  DimTime              DimTime              @relation(fields: [TimeID], references: [TimeID], onDelete: NoAction, onUpdate: NoAction)
  DimPromoCampaign     DimPromoCampaign?    @relation(fields: [PromoCampaignID], references: [PromoCampaignID], onDelete: NoAction, onUpdate: NoAction)
}
